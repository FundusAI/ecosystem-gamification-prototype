<!-- overview.html -->

{% extends 'layout.html' %}

{% block style %}
    .overview-card {
        color: #fff;
        padding: 20px;
        border-radius: 10px;
        margin: 20px auto;
    }

    .points-text {
        font-size: 1.5em;
        margin: 10px 0;
    }

    .progress-bar-container {
        position: relative;
        width: 100%;
        height: 10px;
        margin-top: 10px;
    }

    .remaining-bar, .progress-bar {
        position: absolute;
        height: 100%;
        border-radius: 5px;
    }

    .remaining-bar {
        width: 100%;
        background-color: rgb(238, 238, 238, 0.5);
        z-index: 1;  /* Set z-index to 1 to position it below progress-bar */
    }

    .progress-bar {
        width: 25%;  /* Adjust the width as needed */
        background-color: #fff;
        z-index: 2;  /* Set z-index to 2 to position it on top of remaining-bar */
    }

    #pointsHeaders {
        display: flex;
        flex-wrap: wrap;
        font-size: 30px;
    }

    #pointsHeaders h1 {
        margin-top: 0px;
    }

    .points-card {
        width: 800px;
        margin-right: 0px;
    }

    .progress-card {
        display: flex;
        width: 1100px;
        height: 250px;
        background-color: #fff;
        box-shadow: 0 0 5px 1px #0447B8;
    }

    .circular-progress {
        width: 200px;
        height: 200px;
        margin: 10px;
    }
    
    .circular-progress p {
        margin: 0;
        font-size: 0.8em;
    }

    .new-record-button {
        display: block;
        background-color: #0447B8;
        color: #fff;
        padding: 10px;
        border-radius: 25px;
        text-decoration: none;
        text-align: center;
        margin-top: 10px;
    }

    .trends {
        background-color: #fff;
        height: 250px;
        width: 260px;
        padding: 30px;
        margin-left: 100px;
    }

    .trends p {
        color: #999;
    }

    .commit-graph {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        max-width: 600px;
        margin: 20px auto;
    }

    .commit-cell {
        width: 20px;
        height: 20px;
        margin: 5px;
        border-radius: 5px;
        position: relative;
        top: 10px;
    }

    #topDiv {
        display: flex;
    }

{% endblock %}


{% block body %}
    <div id="topDiv">
        <!-- Points Card -->
        <div class="overview-card points-card" style="background-color: #0447B8;">
            <p style="font-size: 18px; font-weight: lighter;">Hey Khalifa! Your Available points</p>
            <div id="pointsHeaders">
                <h1>8919 Points&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;üèÖüèÜüèÖ</h1>
            </div>
            <p class="points-text">You have completed <span style="font-weight: bolder;"> 15</span> health tasks today&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-weight: bolder;"> 25%</span> </p>
            <div class="progress-bar-container">
                <div class="remaining-bar"></div>
                <div class="progress-bar"></div>
            </div>
        </div>


        <!-- Commit Graph (updated to a 10x3 grid) -->
        <div class="overview-card trends">
            <h2 style="color: black; margin: 0;">Completed Tasks</h2>
            <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Mon Tue Wed Thu Fri Sat Sun</p>
            
            <div style="display: flex; flex-wrap: wrap;">
                <p>Wk 1&nbsp;</p>
                {% for col in range(1, 8) %}
                    <div class="commit-cell" style="background-color: {{ random_commit_color() }};"></div>
                {% endfor %}
            </div>
            <div style="display: flex; flex-wrap: wrap;">
                <p>Wk 2&nbsp;</p>
                {% for col in range(1, 8) %}
                    <div class="commit-cell" style="background-color: {{ random_commit_color() }};"></div>
                {% endfor %}
            </div>
            <div style="display: flex; flex-wrap: wrap;">
                <p>Wk 3&nbsp;</p>
                {% for col in range(1, 8) %}
                    <div class="commit-cell" style="background-color: {{ random_commit_color() }};"></div>
                {% endfor %}
            </div>
            <div style="display: flex; flex-wrap: wrap;">
                <p>Wk 4&nbsp;</p>
                {% for col in range(1, 8) %}
                    <div class="commit-cell" style="background-color: {{ random_commit_color() }};"></div>
                {% endfor %}
            </div>
        </div>
        
    </div>

    <!-- Today's Progress Card -->
    <div class="overview-card progress-card">
        <div id="progressHeaders">
        <h2 style="color: black;">Today's Progress</h2>
        <a href="{{ url_for('challenge') }}" class="new-record-button">Set a New Record</a>
        </div>
        <canvas id="blood-sugar-progress" class="circular-progress" data-percent="50"></canvas>
        <canvas id="food-progress" class="circular-progress" data-percent="40"></canvas>
        <canvas id="steps-progress" class="circular-progress" data-percent="75"></canvas>
        <canvas id="bp-progress" class="circular-progress" data-percent="60"></canvas>
    </div>

    <script>


        // Function to create circular progress bar using Chart.js
        function createCircularProgressBar(elementId, percent, label, colour, textColor) {

            // label += '\n\n'
            const data = {
                labels: [label],
                datasets: [{
                    data: [percent, 100 - percent],
                    backgroundColor: [colour, `${colour}20`],
                    borderWidth: 1,
                }]
            };

            const doughnutLabel = {
                id: 'doughnutLabel',
                beforeDatasetsDraw(chart, args, pluginOptions) {
                    const { ctx, data  } = chart;

                    ctx.save(); 
                    const xCoor = chart.getDatasetMeta(0).data[0].x;
                    const yCoor = chart.getDatasetMeta(0).data[0].y;
                    ctx.font = 'bold 18px sans-serif';
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                     // Use the label as is, ensuring it already contains line breaks if necessary
            ctx.fillText(data.labels[0], xCoor, yCoor - 15); // Adjust the position as needed
            ctx.fillStyle = textColor;
            ctx.fillText(data.datasets[0].data[0], xCoor, yCoor + 15); // Adjust the position as needed;
                }
            };

        //     new Chart(elementId, {
        //         type: 'doughnut',
        //         data,
        //         options: {
        //             cutout: 75,
        //             borderRadius: 30,
        //             responsive: false,
        //             maintainAspectRatio: false,
        //             legend: {
        //                 display: false,
        //             },
        //         },
        //         plugins: [doughnutLabel],
        //     });
        // };
        new Chart(elementId, {
            type: 'doughnut',
            data,
            options: {
                cutout: 85,
                borderRadius: 30,
                responsive: false,
                maintainAspectRatio: false,
                legend: {
                    display: false,  // This line removes the legend
                },
            },
            plugins: [doughnutLabel],
        });
    }
    Chart.defaults.plugins.legend = false;

       // Call the function for each circular progress bar
// createCircularProgressBar('blood-sugar-progress', 80, 'Blood Sugar\n', '#FEC635', 'rgb(203, 203, 2)'); // Include line break here
// createCircularProgressBar('food-progress', 75, 'Water Intake\n', '#0000FF', 'darkblue'); // Include line break here
// createCircularProgressBar('steps-progress', 40, 'Steps Taken\n', '#FF9839', 'rgb(190, 123, 0)'); // Include line break here
// createCircularProgressBar('bp-progress', 60, 'Blood Pressure\n', '#e60017', 'darkred'); // Include line break here
  createCircularProgressBar('blood-sugar-progress', 80, 'Blood Sugar', '#FEC635', 'rgb(203, 203, 2');
  
  createCircularProgressBar('food-progress', 75, 'Water Intake', '#0000FF', 'darkblue');
  
  createCircularProgressBar('steps-progress', 40, 'Steps Taken', '#FF9839', 'rgb(190, 123, 0)');
  
  createCircularProgressBar('bp-progress', 60, 'Blood Pressure', '#e60017', 'darkred');
  </script>

{% endblock %}

